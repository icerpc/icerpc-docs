<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>

    <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
      <title>Class ConnectionCache
 | IceRPC </title>
      <meta name="viewport" content="width=device-width">
      <meta name="title" content="Class ConnectionCache
 | IceRPC ">
      <meta name="generator" content="docfx ">
  
      <link rel="shortcut icon" href="../favicon.png">
      <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/night-owl.min.css">
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" integrity="sha384-EvBWSlnoFgZlXJvpzS+MAUEjvN7+gcCwH+qh7GRFOGgZO0PuwOFro7qPOJnLfe7l" crossorigin="anonymous">
      <link rel="stylesheet" href="../styles/config.css">
      <link rel="stylesheet" href="../styles/discord.css">
      <link rel="stylesheet" href="../styles/singulink.css">
      <link rel="stylesheet" href="../styles/main.css">
      <meta property="docfx:navrel" content="../toc.html">
      <meta property="docfx:tocrel" content="toc.html">
  
  <meta property="docfx:rel" content="../">
  <meta property="docfx:newtab" content="true">
    </head>
    <body>
        <div class="top-navbar">
            <a class="burger-icon" onclick="toggleMenu()">
                <svg name="Hamburger" style="vertical-align: middle;" width="34" height="34" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" d="M20 6H4V9H20V6ZM4 10.999H20V13.999H4V10.999ZM4 15.999H20V18.999H4V15.999Z"></path></svg>
            </a>


            <a class="brand" href="../index.html">
              <img src="../logo.svg" alt="IceRPC" class="logomark">
              <span class="brand-title">IceRPC</span>
            </a>        </div>

        <div class="body-content">
            <div id="blackout" class="blackout" onclick="toggleMenu()"></div>

            <nav id="sidebar" role="navigation">
                <div class="sidebar">

                    <div>
                      <div class="mobile-hide">

                        <a class="brand" href="../index.html">
                          <img src="../logo.svg" alt="IceRPC" class="logomark">
                          <span class="brand-title">IceRPC</span>
                        </a>                      </div>

                      <div class="sidesearch">
                        <form id="search" role="search" class="search">
                            <i class="bi bi-search search-icon"></i>
                            <input type="text" id="search-query" placeholder="Search" autocomplete="off">
                        </form>
                      </div>

                      <div id="navbar">
                      </div>
                    </div>                    <div class="sidebar-item-separator"></div>

                        <div id="sidetoggle">
                          <div id="sidetoc"></div>
                        </div>
                </div>
                <div class="footer">
  <strong>IceRPC</strong>
  
                </div>            </nav>

            <main class="main-panel">

                <div id="search-results" style="display: none;">
                  <h1 class="search-list">Search Results for <span></span></h1>
                  <div class="sr-items">
                    <p><i class="bi bi-hourglass-split index-loading"></i></p>
                  </div>
                  <ul id="pagination" data-first="First" data-prev="Previous" data-next="Next" data-last="Last"></ul>
                </div>
                <div role="main" class="hide-when-search">

                        <div class="subnav navbar navbar-default">
                          <div class="container hide-when-search" id="breadcrumb">
                            <ul class="breadcrumb">
                              <li></li>
                            </ul>
                          </div>
                        </div>

                    <article class="content wrap" id="_content" data-uid="IceRpc.ConnectionCache">


  <h1 id="IceRpc_ConnectionCache" data-uid="IceRpc.ConnectionCache" class="text-break">Class ConnectionCache
</h1>
  <div class="markdown level0 summary"><p>A connection cache is an invoker that routes outgoing requests to connections it manages. This routing is
based on the <a class="xref" href="IceRpc.Features.IServerAddressFeature.html">IServerAddressFeature</a> and the server addresses of the service address carried by each
outgoing request. The connection cache keeps at most one active connection per server address.</p>
</div>
  <div class="markdown level0 conceptual"></div>
  <div class="inheritance">
    <h5>Inheritance</h5>
    <div class="level0"><span class="xref">object</span></div>
    <div class="level1"><span class="xref">ConnectionCache</span></div>
  </div>
  <div class="implements">
    <h5>Implements</h5>
    <div><a class="xref" href="IceRpc.IInvoker.html">IInvoker</a></div>
    <div><span class="xref">IAsyncDisposable</span></div>
  </div>
  <div class="inheritedMembers">
    <h5>Inherited Members</h5>
    <div>
      <span class="xref">object.GetType()</span>
    </div>
    <div>
      <span class="xref">object.ToString()</span>
    </div>
    <div>
      <span class="xref">object.Equals(object)</span>
    </div>
    <div>
      <span class="xref">object.Equals(object, object)</span>
    </div>
    <div>
      <span class="xref">object.ReferenceEquals(object, object)</span>
    </div>
    <div>
      <span class="xref">object.GetHashCode()</span>
    </div>
  </div>
  <h6><strong>Namespace</strong>: <a class="xref" href="IceRpc.html">IceRpc</a></h6>
  <h6><strong>Assembly</strong>: IceRpc.dll</h6>
  <h5 id="IceRpc_ConnectionCache_syntax">Syntax</h5>
  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public sealed class ConnectionCache : IInvoker, IAsyncDisposable</code></pre>
  </div>
  <h3 id="constructors">Constructors
</h3>


  <a id="IceRpc_ConnectionCache__ctor_" data-uid="IceRpc.ConnectionCache.#ctor*"></a>
  <h4 id="IceRpc_ConnectionCache__ctor" data-uid="IceRpc.ConnectionCache.#ctor">ConnectionCache()</h4>
  <div class="markdown level1 summary"><p>Constructs a connection cache using the default options.</p>
</div>
  <div class="markdown level1 conceptual"></div>
  <h5 class="declaration">Declaration</h5>
  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public ConnectionCache()</code></pre>
  </div>


  <a id="IceRpc_ConnectionCache__ctor_" data-uid="IceRpc.ConnectionCache.#ctor*"></a>
  <h4 id="IceRpc_ConnectionCache__ctor_IceRpc_ConnectionCacheOptions_IceRpc_Transports_IDuplexClientTransport_IceRpc_Transports_IMultiplexedClientTransport_Microsoft_Extensions_Logging_ILogger_" data-uid="IceRpc.ConnectionCache.#ctor(IceRpc.ConnectionCacheOptions,IceRpc.Transports.IDuplexClientTransport,IceRpc.Transports.IMultiplexedClientTransport,Microsoft.Extensions.Logging.ILogger)">ConnectionCache(ConnectionCacheOptions, IDuplexClientTransport?, IMultiplexedClientTransport?, ILogger?)</h4>
  <div class="markdown level1 summary"><p>Constructs a connection cache.</p>
</div>
  <div class="markdown level1 conceptual"></div>
  <h5 class="declaration">Declaration</h5>
  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public ConnectionCache(ConnectionCacheOptions options, IDuplexClientTransport? duplexClientTransport = null, IMultiplexedClientTransport? multiplexedClientTransport = null, ILogger? logger = null)</code></pre>
  </div>
  <h5 class="parameters">Parameters</h5>
  <table class="table table-bordered table-condensed">
    <thead>
      <tr>
        <th>Type</th>
        <th>Name</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><a class="xref" href="IceRpc.ConnectionCacheOptions.html">ConnectionCacheOptions</a></td>
        <td><span class="parametername">options</span></td>
        <td><p>The connection cache options.</p>
</td>
      </tr>
      <tr>
        <td><a class="xref" href="IceRpc.Transports.IDuplexClientTransport.html">IDuplexClientTransport</a></td>
        <td><span class="parametername">duplexClientTransport</span></td>
        <td><p>The duplex client transport. <span class="xref">null</span> is equivalent to <a class="xref" href="IceRpc.Transports.IDuplexClientTransport.html#IceRpc_Transports_IDuplexClientTransport_Default">Default</a>.</p>
</td>
      </tr>
      <tr>
        <td><a class="xref" href="IceRpc.Transports.IMultiplexedClientTransport.html">IMultiplexedClientTransport</a></td>
        <td><span class="parametername">multiplexedClientTransport</span></td>
        <td><p>The multiplexed client transport. <span class="xref">null</span> is equivalent
to <a class="xref" href="IceRpc.Transports.IMultiplexedClientTransport.html#IceRpc_Transports_IMultiplexedClientTransport_Default">Default</a>.</p>
</td>
      </tr>
      <tr>
        <td><span class="xref">ILogger</span></td>
        <td><span class="parametername">logger</span></td>
        <td><p>The logger. <span class="xref">null</span> is equivalent to <span class="xref">Microsoft.Extensions.Logging.Abstractions.NullLogger.Instance</span>.</p>
</td>
      </tr>
    </tbody>
  </table>
  <h3 id="methods">Methods
</h3>


  <a id="IceRpc_ConnectionCache_DisposeAsync_" data-uid="IceRpc.ConnectionCache.DisposeAsync*"></a>
  <h4 id="IceRpc_ConnectionCache_DisposeAsync" data-uid="IceRpc.ConnectionCache.DisposeAsync">DisposeAsync()</h4>
  <div class="markdown level1 summary"><p>Releases all resources allocated by the cache. The cache disposes all the connections it
created.</p>
</div>
  <div class="markdown level1 conceptual"></div>
  <h5 class="declaration">Declaration</h5>
  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public ValueTask DisposeAsync()</code></pre>
  </div>
  <h5 class="returns">Returns</h5>
  <table class="table table-bordered table-condensed">
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><span class="xref">ValueTask</span></td>
        <td><p>A value task that completes when the disposal of all connections created by this cache has completed.
This includes connections that were active when this method is called and connections whose disposal was
initiated prior to this call.</p>
</td>
      </tr>
    </tbody>
  </table>
  <h5 id="IceRpc_ConnectionCache_DisposeAsync_remarks">Remarks</h5>
  <div class="markdown level1 remarks"><p>The disposal of an underlying connection of the cache  aborts invocations, cancels dispatches and
disposes the underlying transport connection without waiting for the peer. To wait for invocations and
dispatches to complete, call <a class="xref" href="IceRpc.ConnectionCache.html#IceRpc_ConnectionCache_ShutdownAsync_System_Threading_CancellationToken_">ShutdownAsync(CancellationToken)</a> first. If the configured dispatcher does not complete
promptly when its cancellation token is canceled, the disposal can hang.</p>
</div>


  <a id="IceRpc_ConnectionCache_InvokeAsync_" data-uid="IceRpc.ConnectionCache.InvokeAsync*"></a>
  <h4 id="IceRpc_ConnectionCache_InvokeAsync_IceRpc_OutgoingRequest_System_Threading_CancellationToken_" data-uid="IceRpc.ConnectionCache.InvokeAsync(IceRpc.OutgoingRequest,System.Threading.CancellationToken)">InvokeAsync(OutgoingRequest, CancellationToken)</h4>
  <div class="markdown level1 summary"><p>Sends an outgoing request and returns the corresponding incoming response. If the request
<a class="xref" href="IceRpc.Features.IServerAddressFeature.html">IServerAddressFeature</a> feature is not set, the cache sets it from the server addresses of the
target service. It then looks for an active connection.
The <a class="xref" href="IceRpc.ConnectionCacheOptions.html#IceRpc_ConnectionCacheOptions_PreferExistingConnection">PreferExistingConnection</a> property influences how the cache selects
this active connection. If no active connection can be found, the cache creates a new connection to one of the
the request's server addresses from the <a class="xref" href="IceRpc.Features.IServerAddressFeature.html">IServerAddressFeature</a> feature. If the connection
establishment to <a class="xref" href="IceRpc.Features.IServerAddressFeature.html#IceRpc_Features_IServerAddressFeature_ServerAddress">ServerAddress</a> is unsuccessful, the cache will try to
establish a connection to one of the <a class="xref" href="IceRpc.Features.IServerAddressFeature.html#IceRpc_Features_IServerAddressFeature_AltServerAddresses">AltServerAddresses</a> addresses. Each
connection attempt rotates the server addresses of the server address feature, the main server address
corresponding to the last attempt failure is appended at the end of
<a class="xref" href="IceRpc.Features.IServerAddressFeature.html#IceRpc_Features_IServerAddressFeature_AltServerAddresses">AltServerAddresses</a> and the first address from
<a class="xref" href="IceRpc.Features.IServerAddressFeature.html#IceRpc_Features_IServerAddressFeature_AltServerAddresses">AltServerAddresses</a> replaces
<a class="xref" href="IceRpc.Features.IServerAddressFeature.html#IceRpc_Features_IServerAddressFeature_ServerAddress">ServerAddress</a>. If the cache cannot find an active connection and all
the attempts to establish a new connection fail, this method throws the exception from the last attempt.</p>
</div>
  <div class="markdown level1 conceptual"></div>
  <h5 class="declaration">Declaration</h5>
  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public Task&lt;IncomingResponse&gt; InvokeAsync(OutgoingRequest request, CancellationToken cancellationToken)</code></pre>
  </div>
  <h5 class="parameters">Parameters</h5>
  <table class="table table-bordered table-condensed">
    <thead>
      <tr>
        <th>Type</th>
        <th>Name</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><a class="xref" href="IceRpc.OutgoingRequest.html">OutgoingRequest</a></td>
        <td><span class="parametername">request</span></td>
        <td><p>The outgoing request being sent.</p>
</td>
      </tr>
      <tr>
        <td><span class="xref">CancellationToken</span></td>
        <td><span class="parametername">cancellationToken</span></td>
        <td><p>A cancellation token that receives the cancellation requests.</p>
</td>
      </tr>
    </tbody>
  </table>
  <h5 class="returns">Returns</h5>
  <table class="table table-bordered table-condensed">
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><span class="xref">Task</span>&lt;<a class="xref" href="IceRpc.IncomingResponse.html">IncomingResponse</a>&gt;</td>
        <td><p>The corresponding <a class="xref" href="IceRpc.IncomingResponse.html">IncomingResponse</a>.</p>
</td>
      </tr>
    </tbody>
  </table>


  <a id="IceRpc_ConnectionCache_ShutdownAsync_" data-uid="IceRpc.ConnectionCache.ShutdownAsync*"></a>
  <h4 id="IceRpc_ConnectionCache_ShutdownAsync_System_Threading_CancellationToken_" data-uid="IceRpc.ConnectionCache.ShutdownAsync(System.Threading.CancellationToken)">ShutdownAsync(CancellationToken)</h4>
  <div class="markdown level1 summary"><p>Gracefully shuts down all connections created by this cache.</p>
</div>
  <div class="markdown level1 conceptual"></div>
  <h5 class="declaration">Declaration</h5>
  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public Task ShutdownAsync(CancellationToken cancellationToken = default)</code></pre>
  </div>
  <h5 class="parameters">Parameters</h5>
  <table class="table table-bordered table-condensed">
    <thead>
      <tr>
        <th>Type</th>
        <th>Name</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><span class="xref">CancellationToken</span></td>
        <td><span class="parametername">cancellationToken</span></td>
        <td><p>A cancellation token that receives the cancellation requests.</p>
</td>
      </tr>
    </tbody>
  </table>
  <h5 class="returns">Returns</h5>
  <table class="table table-bordered table-condensed">
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><span class="xref">Task</span></td>
        <td><p>A task that completes successfully once the shutdown of all connections created by this cache has
completed. This includes connections that were active when this method is called and connections whose shutdown
was initiated prior to this call. This task can also complete with one of the following exceptions:</p>
<ul><li><a class="xref" href="IceRpc.IceRpcException.html">IceRpcException</a> with error <a class="xref" href="IceRpc.IceRpcError.html#IceRpc_IceRpcError_OperationAborted">OperationAborted</a> if the
connection cache is disposed while being shut down.</li><li><span class="xref">System.OperationCanceledException</span>if cancellation was requested through the
cancellation token.</li><li><span class="xref">System.TimeoutException</span>if the shutdown timed out.</li></ul>
</td>
      </tr>
    </tbody>
  </table>
  <h5 class="exceptions">Exceptions</h5>
  <table class="table table-bordered table-condensed">
    <thead>
      <tr>
        <th>Type</th>
        <th>Condition</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><span class="xref">System.InvalidOperationException</span></td>
        <td><p>Thrown if this method is called more than once.</p>
</td>
      </tr>
      <tr>
        <td><span class="xref">System.ObjectDisposedException</span></td>
        <td><p>Thrown if the server is disposed.</p>
</td>
      </tr>
    </tbody>
  </table>
  <h3 id="implements">Implements</h3>
  <div>
      <a class="xref" href="IceRpc.IInvoker.html">IInvoker</a>
  </div>
  <div>
      <span class="xref">System.IAsyncDisposable</span>
  </div>
</article>
                </div>

                <div class="copyright-footer">
                    <span>Copyright &#169; ZeroC, Inc.</span>
                </div>
            </main>
        </div>


        <script src="https://code.jquery.com/jquery-3.6.3.min.js" integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js" integrity="sha384-+sLIOodYLS7CIrQpBjl+C7nPvqq+FbNUBDunl/OZv93DB7Ln/533i8e/mZXLi/P+" crossorigin="anonymous"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
        <script type="text/javascript" src="../styles/jquery.twbsPagination.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/jquery.mark.min.js"></script>
        <script type="text/javascript" src="../styles/url.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/anchor-js@5.0.0/anchor.min.js"></script>
        <script type="text/javascript" src="../styles/docfx.js"></script>
        <script type="text/javascript" src="../styles/singulink.js"></script>
        <script type="text/javascript" src="../styles/main.js"></script>    </body>
</html>
