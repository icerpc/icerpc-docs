---
title: 'Writing your first application'
---

This tutorial shows how to create a complete application with IceRPC for C#.
We start from scratchâ€”you just need to have the .NET 7 SDK or .NET 8 SDK
installed on your computer.

The networked application we are building together consists of:

- a server that hosts a single service (a simple greeter service)
- a client that establishes a connection to the server and calls `greet` on
  this greeter service

The client and server are console applications that use plain .NET (no ASP.NET,
no Dependency Injection).

Let's jump right in:

{% step title="Starting point" %}

We will use the `Console App` .NET project template for both the client and server
for this tutorial.

```shell {% showTitle=false %}
dotnet new console -o MyServer
dotnet new console -o MyClient
```

{% /step %}

{% step title="Adding IceRPC" %}

Next, we will need to install the relevant [IceRPC NuGet packages][nuget-packages]
to both the client and server projects. We will be using IceRPC + Slice
to define the service contract and will be using the Deadline and Logger
middlewares and interceptors.

#### Client

```shell {% showTitle=false %}
cd MyClient
dotnet add package IceRpc.Slice
dotnet add package IceRpc.Slice.Tools
dotnet add package IceRpc.Deadline
dotnet add package IceRpc.Logger
```

#### Server

```shell {% showTitle=false %}
cd MyServer
dotnet add package IceRpc.Slice
dotnet add package IceRpc.Slice.Tools
dotnet add package IceRpc.Deadline
dotnet add package IceRpc.Logger
```

{% /step %}

## Server

Now that we have our project setup, let's start writing some code. We will
start with the server.

{% step title="Defining the Slice contract" id="server-slice" level=3 %}

This file holds the contract between our client and server applications,
specified using the Slice language. It's a simple greeter:

```slice {% title="slice/Greeter.slice" %}
[cs::namespace("MyServer")]
module VisitorCenter

/// Represents a simple greeter.
interface Greeter {
    /// Creates a personalized greeting.
    /// @param name: The name of the person to greet.
    /// @returns: The greeting.
    greet(name: string) -> string
}
```

{% /step %}

{% step title="Service implementation" level=3 %}

Next we need to define the implementation of our Greeter service. We will
implement the `IGreeterService` interface generated by the Slice compiler.

```csharp {% title="Program.cs" %}
internal class Chatbot : Service, IGreeterService
{
    public ValueTask<string> GreetAsync(string name, IFeatureCollection features, CancellationToken cancellationToken)
    {
        Console.WriteLine($"Dispatching greet request {{ name = '{name}' }}");
        return new($"Hello, {name}!");
    }
}
```

{% /step %}

{% step title="Server Program.cs" level=3 %}

Finally we need to create a server that listens for incoming connections and
dispatches requests to our service implementation. We will do this at the
programs entry point for simplicity.

To do this, we will create a `Router` and map our service implementation to
the default path for this interface: `/VisitorCenter.Greeter`.

Additionally we will install two middlewares on the router:

- `UseLogger` to log requests and responses
- `UseDeadline` to enforce a deadline on requests

```csharp {% title="Program.cs" %}
using IceRpc;
using IceRpc.Slice;
using Microsoft.Extensions.Logging;

using IceRpc_Server;

// Create a simple console logger factory and configure the log level for category IceRpc.
using ILoggerFactory loggerFactory = LoggerFactory.Create(builder =>
    builder
        .AddSimpleConsole()
        .AddFilter("IceRpc", LogLevel.Debug));

// Create a router (dispatch pipeline), install two middleware and map our implementation of `IGreeterService`
// at the default path for this interface: `/VisitorCenter.Greeter`
Router router = new Router()
    .UseLogger(loggerFactory)
    .UseDeadline()
    .Map<IGreeterService>(new Chatbot());

// Create a server that logs message to a logger with category `IceRpc.Server`.
await using var server = new Server(router, logger: loggerFactory.CreateLogger<Server>());

server.Listen();

// Wait until the console receives a Ctrl+C.
await CancelKeyPressed;
await server.ShutdownAsync();
```

{% /step %}

{% step title="Ctrl+C helper" level=3 %}

This file contains a few lines of code that `Programs.cs` uses to wait for
Ctrl+C. It's not related to RPCs.

```csharp {% title="Program.CancelKeyPressed.cs" %}
// Extends Program to provide the CancelKeyPressed property.
public static partial class Program
{
    /// <summary>Gets a task that completes when the console receives a Ctrl+C.</summary>
    public static Task CancelKeyPressed => _cancelKeyPressedTcs.Task;

    private static readonly TaskCompletionSource _cancelKeyPressedTcs = new();

    static Program() =>
        Console.CancelKeyPress += (sender, eventArgs) =>
        {
            eventArgs.Cancel = true;
            _ = _cancelKeyPressedTcs.TrySetResult();
        };
}

```

{% /step %}

## Client

Now that we have our server, let's write the client.

{% step title="Defining the Slice contract" id="client-slice" level=3 %}

Similarly to the Servers Slice file, this file holds the contract between our
client and server applications, specified using the Slice language. It's a
simple greeter:

```slice {% title="slice/Greeter.slice" %}
[cs::namespace("IceRpc_Client")]
module VisitorCenter

/// Represents a simple greeter.
interface Greeter {
    /// Creates a personalized greeting.
    /// @param name: The name of the person to greet.
    /// @returns: The greeting.
    greet(name: string) -> string
}
```

{% /step %}

{% step title="Client Program.cs" level=3 %}

Finally, we need to create a client that establishes a connection to the
server and calls `greet` on the greeter service. We will do this at the
programs entry point for simplicity.

To do this, we will create a `Pipeline` and install two interceptors
on it that will be used for all requests:

- `UseLogger` to log requests and responses
- `UseDeadline` to enforce a deadline on requests

```csharp {% title="Program.cs" %}
using IceRpc;
using Microsoft.Extensions.Logging;

using IceRpc_Client;

// Create a simple console logger factory and configure the log level for category IceRpc.
using ILoggerFactory loggerFactory = LoggerFactory.Create(builder =>
    builder
        .AddSimpleConsole()
        .AddFilter("IceRpc", LogLevel.Debug));

// Create a client connection that logs messages to a logger with category IceRpc.ClientConnection.
await using var connection = new ClientConnection(
    new Uri("icerpc://localhost"),
    logger: loggerFactory.CreateLogger<ClientConnection>());

// Create an invocation pipeline with two interceptors.
Pipeline pipeline = new Pipeline()
    .UseLogger(loggerFactory)
    .UseDeadline(defaultTimeout: TimeSpan.FromSeconds(10))
    .Into(connection);

// Create a greeter proxy with this invocation pipeline.
var greeterProxy = new GreeterProxy(pipeline);

string greeting = await greeterProxy.GreetAsync(Environment.UserName);

Console.WriteLine(greeting);

await connection.ShutdownAsync();
```

{% /step %}

## Running the applications

We have no finished writing our client and server. Let's run them!

#### Start the server

```shell {% showTitle=false %}
cd MyServer
dotnet run
```

The server is now listening for new connections from clients:

```shell {% showTitle=false %}
dbug: IceRpc.Server[11]
      Listener 'icerpc://[::0]?transport=tcp' has started accepting connections
```

#### Start the client

```shell {% showTitle=false %}
cd MyClient
dotnet run
```

The client sends a single `greet` request to the service hosted by our server:

```
dbug: IceRpc.ClientConnection[3]
      Client connection from '[::1]:61582' to '[::1]:4062' connected
info: IceRpc.Logger.LoggerInterceptor[0]
      Sent request greet to icerpc:/VisitorCenter.Greeter over
      [::1]:61582<->[::1]:4062 and received a response with status code Ok
Hello, Reece!
dbug: IceRpc.ClientConnection[6]
      Client connection from '[::1]:61582' to '[::1]:4062' shutdown
dbug: IceRpc.ClientConnection[5]
      Client connection from '[::1]:61582' to '[::1]:4062' disposed
```

#### Shutdown the server

Press Ctrl+C on the server console to shut it down.

```
dbug: IceRpc.Server[12]
      Listener 'icerpc://[::0]?transport=tcp' has stopped accepting connections
```

## Next steps

Congratulations! You have successfully written your first IceRPC application.
We recommend you to continue with by reading the following to learn more about
what each file in this tutorial does:

- [Server Project Overview][server-overview]
- [Client Project Overview][client-overview]

[nuget-packages]: /getting-started/installation/nuget-packages
[server-overview]: /getting-started/using-icerpc/server-project-overview
[client-overview]: /getting-started/using-icerpc/client-project-overview
